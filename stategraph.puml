@startuml 商城系统状态图

title 在线商城系统状态图

scale 1600 width

' 用户状态
state "用户状态" as UserState {
  [*] --> 未登录
  未登录 --> 已登录 : 登录/注册
  已登录 --> 未登录 : 退出登录/会话过期
  
  state 已登录 {
    [*] --> 普通用户
    普通用户 --> 商家用户 : 申请成为商家并审核通过
    普通用户 --> 管理员 : 分配管理员权限
    
    state 普通用户 {
      [*] --> 浏览中
      浏览中 --> 购物中 : 查看商品
      购物中 --> 浏览中 : 返回浏览
      购物中 --> 结算中 : 提交订单
      结算中 --> 购物中 : 取消结算
    }
    
    state 商家用户 {
      [*] --> 店铺管理
      店铺管理 --> 商品管理 : 管理商品
      商品管理 --> 店铺管理 : 返回店铺
      店铺管理 --> 订单管理 : 查看订单
      订单管理 --> 店铺管理 : 返回店铺
    }
    
    state 管理员 {
      [*] --> 系统管理
      系统管理 --> 用户管理 : 管理用户
      系统管理 --> 商家审核 : 审核商家申请
      系统管理 --> 分类管理 : 管理商品分类
      用户管理 --> 系统管理 : 返回
      商家审核 --> 系统管理 : 返回
      分类管理 --> 系统管理 : 返回
    }
  }
}

' 商品状态
state "商品状态" as ProductState {
  [*] --> 创建中
  创建中 --> 待审核 : 提交审核
  创建中 --> 未上架 : 保存为草稿
  待审核 --> 已上架 : 审核通过并上架
  待审核 --> 未上架 : 审核通过但不上架
  待审核 --> 审核不通过 : 审核拒绝
  已上架 --> 未上架 : 下架商品
  未上架 --> 已上架 : 上架商品
  已上架 --> 售罄 : 库存为0
  售罄 --> 已上架 : 补充库存
  已上架 --> 已删除 : 删除商品
  未上架 --> 已删除 : 删除商品
  审核不通过 --> 创建中 : 修改后重新提交
  已删除 --> [*]
}

' 购物车状态
state "购物车状态" as CartState {
  [*] --> 空购物车
  空购物车 --> 有商品 : 添加商品
  有商品 --> 空购物车 : 删除所有商品
  有商品 --> 有商品 : 修改商品数量/选择状态
  有商品 --> 结算中 : 结算购物车
  结算中 --> 有商品 : 返回购物车
  结算中 --> [*] : 生成订单
}

' 订单状态
state "订单状态" as OrderState {
  [*] --> 待付款 : 创建订单
  待付款 --> 待发货 : 支付订单
  待付款 --> 已取消 : 取消订单/超时未支付
  待发货 --> 待收货 : 卖家发货
  待收货 --> 已完成 : 确认收货/自动确认
  已完成 --> 售后中 : 申请售后/退款
  售后中 --> 已完成 : 售后处理完成
  已取消 --> [*]
  已完成 --> [*]
}

' 商家申请状态
state "商家申请状态" as SellerApplicationState {
  [*] --> 待提交
  待提交 --> 待审核 : 提交申请
  待审核 --> 审核通过 : 管理员审核通过
  待审核 --> 审核拒绝 : 管理员审核拒绝
  审核拒绝 --> 待提交 : 重新申请
  审核通过 --> [*]
}

' 支付状态
state "支付状态" as PaymentState {
  [*] --> 未支付
  未支付 --> 支付中 : 发起支付
  支付中 --> 支付成功 : 完成支付
  支付中 --> 支付失败 : 支付异常
  支付失败 --> 未支付 : 重新支付
  支付成功 --> [*]
}

' 物流状态
state "物流状态" as LogisticsState {
  [*] --> 待发货
  待发货 --> 已发货 : 商家发货
  已发货 --> 运输中 : 物流开始运输
  运输中 --> 已送达 : 物流送达
  已送达 --> 已签收 : 用户确认收货
  已签收 --> [*]
}

' 组件间关系
UserState -down-> CartState : 用户操作购物车
UserState -down-> OrderState : 用户管理订单
UserState -right-> SellerApplicationState : 普通用户申请成为商家
SellerApplicationState -up-> ProductState : 成为商家后管理商品
OrderState -right-> PaymentState : 订单创建后支付
OrderState -right-> LogisticsState : 已支付订单的物流状态

@enduml